# Nom du workflow qui apparaîtra dans GitHub
name: CI - Python Tests & Supabase

# Déclenchement du workflow :
# - à chaque push sur main
# - à chaque pull request vers main
on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    # Définition du type de runner : ici une machine Ubuntu
    runs-on: ubuntu-latest

    steps:
      # Étape 1 : Récupérer le code du dépôt
      - name: Checkout du repository
        uses: actions/checkout@v3

      # Étape 2 : Installer Python 3.12
      - name: Installer Python 3.12
        uses: actions/setup-python@v4
        with:
          python-version: "3.12"

      # Étape 3 : Installer les dépendances du projet
      - name: Installer les dépendances
        run: |
          python -m pip install --upgrade pip  # Mise à jour de pip
          pip install -r requirements.txt       # Installation des modules

      # Étape 4 : Exporter les variables d'environnement (exemple Supabase)
      # Les valeurs sont stockées dans GitHub Secrets pour éviter qu'elles soient exposées
      - name: Charger les variables d’environnement
        run: |
          echo "SUPABASE_URL=${{ secrets.SUPABASE_URL }}" >> $GITHUB_ENV
          echo "SUPABASE_KEY=${{ secrets.SUPABASE_KEY }}" >> $GITHUB_ENV

      # Étape 5 : Lancer les tests unitaires avec pytest
      - name: Exécution des tests
        run: PYTHONPATH=$GITHUB_WORKSPACE pytest tests/

